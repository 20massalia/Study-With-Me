# NoSQL

## 개념

NoSQL이란 Not Only SQL의 약자입니다. RDBMS의 스키마, JOIN, ACID 중심의 패러다임 대신에 확장성과 유연한 모델을 우선시하는 데이터베이스 계열입니다.

공통적인 목표로는 아래와 같습니다.

- 대규모 트래픽/데이터
- 낮은 지연
- 고가용성
- 특정 워크로드 최적화 (세션, 피드, 타임라인, 검색, 로그, 시계열 등

### 비정형 데이터와 정형 데이터

정형 데이터는 일관적이며 사전 정의된 형식으로 구성된 데이터로, 영숫자로 구성된 경우가 많습니다.
예를 들어 금융 거래, 재고 기록 또는 고객 목록이 있으며, 이러한 데이터는 SQL 데이터베이스(예: 관계형 데이터베이스)에 저장되는 경우가 많습니다.

비정형 데이터는 사전 정의된 데이터 모델이나 일관적인 구성이 없는 데이터입니다.
또한 소셜 미디어 게시물과 같은 비정형 데이터는 빠르게 업데이트되고 변경될 수 있는 반면, 은행 거래와 같은 정형 데이터는 변경 속도가 훨씬 느립니다.
비정형 데이터의 예로는 사진, 오디오 파일, 동영상, 지도 등이 있습니다.

유연한 스키마를 사용하면 NoSQL 데이터베이스가 비정형 데이터를 네이티브 형식(.txt, .JPG, MP3)으로 수집할 수 있는데, 이는 모든 데이터를 사전 정의된 형식에 맞춰야 하는 SQL 데이터베이스에서는 불가능한 일입니다.
또한 NoSQL 데이터베이스는 데이터를 저장할 때 유연한 데이터 모델을 사용하므로 비정형 데이터 파일이 서로 다른 데이터 구조를 가지면서도 동일한 컬렉션 내에 저장될 수 있습니다.

### Schema-Less

NoSQL은 스키마 없이 동작합니다.

데이터 구조를 미리 정의할 필요 없이 비형식적인 데이터를 저장하는데 용이합니다.

하지만, 데이터베이스가 스키마를 직접 관리하지 않을 뿐, 데이터 타입에 따른 암묵적인 스키마는 존재합니다.

## NoSQL 데이터베이스 유형

- Document Database: 문서 데이터베이스는 객체 지향 데이터베이스라고도 하며, JSON(JavaScript Object Notation) 객체와 유사하지만 JSON 스토어는 아닌 문서에 데이터를 저장합니다. 네이티브 객체에서 개발자가 사용하는 프로그래밍 언어로 반환된 드라이버를 사용하므로 ORM(객체 관계 매퍼)이 필요하지 않습니다. 각 문서 자체는 레코드로 취급되며 숫자, 배열, 객체, 문자열 또는 부울 문자 등의 값을 포함할 수 있습니다. 또한 키-값 쌍, 중첩된 문서 또는 기타 정형 데이터도 포함할 수 있습니다.
- Key-Value Database: 데이터를 키-값 쌍의 그룹으로 수집, 조회, 저장합니다. 즉, 각 데이터 레코드는 고유 키와 연관된 값으로 표현됩니다. 키는 데이터베이스에서 해당하는 값을 조회하는 데 사용됩니다. 예를 들어 인테리어 디자인 키-값 데이터베이스에서 키는 '색상', 값은 '보라색'일 수 있습니다.
- Column-Family Database: 컬럼 패밀리 데이터베이스는 데이터를 행이 아닌 열으로 구성하므로 깊이가 희박한 광범위한 데이터 세트로 작업할 때 유용합니다. 실제로 컬럼-패밀리 스토어는 '와이드 컬럼 스토어'라고도 합니다. 컬럼-패밀리 스토어에서 각 행에는 서로 다른 열 세트가 있으며, 열은 '패밀리'로 모입니다. 이러한 데이터 모델은 성능을 최적화하기 위해 수평적 확장의 이점이 있는 대규모 데이터 세트로 작업할 때 유용합니다.
- Graph Database: 그래프 데이터베이스는 노드와 에지에 데이터를 저장합니다. 노드에는 일반적으로 사람, 장소 및 사물에 대한 정보가 저장되고, 에지에는 노드 간의 관계에 대한 정보가 저장됩니다. 그래프 데이터베이스는 그래프 구조(소셜 네트워크, 계층 구조)를 쿼리하는 데 탁월한 도구입니다.

![NoSQL](https://www.scylladb.com/wp-content/uploads/nosql-design-principles-diagram.png)

## CAP 이론

CAP 이론은 분산 데이터베이스 시스템에서 의미있는 이론입니다.
분산 데이터베이스의 세 가지 속성인 일관성(Consistency), 가용성(Availability), 네트워크 파티션 허용(Partition tolerance)을 나타냅니다. 
처음 CAP 이론이 발표된 후, 시간이 지나면서 이론의 허점이 발견되었고 이를 보완하는 PACELC 이론이 나오게 됩니다.

![CAP](https://miro.medium.com/1*hesm6wzPQHQY5w_hb2U33A.png)

1. C (Consistency, 일관성): 모든 노드가 같은 값을 본다.
2. A (Availability, 가용성): 일부 노드의 장애, 분할 중에도 요청에 응답한다.
3. P (Partition Tolerance, 네트워크 분할 허용성): 네트워크 분할이 나도 시스템이 계속 동작한다.

NoSQL에서는 네트워크 분할(P)이 발생하면 C와 A를 동시에 완벽히 보장 불가합니다.

- 시스템은 보통 CP(일관성 우선) 또는 AP(가용성 우선) 성향을 갖습니다.
- 예시
  - Cassandra/DynamoDB: 기본 AP(가용성/내결함성) + 읽기/쓰기 가중치로 일관성 조절(튜너블)
  - MongoDB: 다수 파티션(majority) 기준으로 설정 시 CP 성향(리더-팔로워 기반)

## 언제 NoSQL을 써야할까?

- NoSQL 권장: 대규모 쓰기/읽기, 스키마 자주 변함, 조인이 단순/불필요, 저지연, 수평 확장 필수
- RDB 권장: 강한 일관성/트랜잭션/참조 무결성/복잡 조인·리포팅 핵심
- 실무 다수는 폴리글랏: RDB(정합/거래) + NoSQL(캐시/피드/서치/로그)

| 유형    | 대표 제품                                    | 일관성 성향                  | 강점                               | 약점                         | 주 사용처            |
|-------|------------------------------------------|-------------------------|----------------------------------|----------------------------|------------------|
| 문서형   | MongoDB, Couchbase, DynamoDB             | CP 성향(설정에 따라), 일부 AP    | JSON 유연성, 문서 단위 원자성, 풍부한 쿼리/인덱스  | 다문서 트랜잭션 비용↑, 샤딩 설계 난이도    | 프로필/콘텐츠/이벤트 API  |
| 키-값   | Redis, Riak, Aerospike                   | AP 경향                   | 초고속 응답, 단순 확장, TTL·만료 쉬움         | 키 외 다차원 질의 취약, 조인 불가/제약    | 캐시/세션/카운터/랭킹     |
| 와이드컬럼 | Apache Cassandra, HBase                  | AP(튜너블 정족수), HBase는 CP  | 선형에 가까운 수평 확장, 대량 쓰기 최적화         | 쿼리 우선 스키마 필요, Ad-hoc 질의 약함 | 로그/타임라인/IoT 시계열  |
| 그래프   | Neo4j, Amazon Neptune, JanusGraph        | CP 경향                   | 관계 탐색·경로·추천 최강, 그래프 질의(Cypher 등) | 분산/쓰기 난이도↑, 대량 OLTP엔 부적합   | 추천/소셜 그래프/권한 그래프 |
| 검색    | Elasticsearch/OpenSearch, Solr           | NRT(최종적 일관성)            | 전문 검색·랭킹·하이라이트·집계(분석)            | 트랜잭션/무결성 약함, 세그먼트 머지 비용    | 검색, 로그/모니터링(ELK) |
| 시계열   | InfluxDB, TimescaleDB(PG 확장), Prometheus | 제품별 상이(대개 Eventual/튜너블) | 고속 삽입, 압축/다운샘플링/TTL, 윈도 집계       | 범용 조인/트랜잭션 제한, 도구별 문법 상이   | 모니터링/센서/금융 틱 데이터 |

## Reference

https://www.mongodb.com/ko-kr/resources/basics/databases/nosql-explained/nosql-vs-sql
https://osy0907.tistory.com/95