# B 트리

결론적으로 B+Tree가 인덱스에 더 많이 쓰이는 결정적 이유는 “범위검색”, “정렬”, “연속데이터 접근” 성능이 훨씬 뛰어나기 때문입니다.

아래에서 B-Tree 인덱스와 B+Tree에 대해서 깊게 살펴보겠습니다.

## B-Tree 인덱스

B-Tree는 자식 2개 만을 갖는 이진 트리를 확장해서 N개의 자식을 가질 수 있도록 고안된 자료구조입니다.

이 자료구조는 최상위의 하나의 루트 노드를 가집니다. 그리고 중간에 브랜치 노드, 최하위의 노드를 리프 노드라고 합니다.

![B-Tree 인덱스](https://blog.kakaocdn.net/dna/djhlni/btrXnJAFNh0/AAAAAAAAAAAAAAAAAAAAAKSjTmRIzxVIaSMDmGfav6lRDKGejU2XR615TFO3nDZ5/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1759244399&allow_ip=&allow_referer=&signature=dv%2B%2FJJkepUDLQa%2BUOUeyI3yFS1g%3D)

먼저 인덱스의 저장 방식을 이해하기 위해서는 페이지(블럭)에 대해서 추가로 설명할 필요가 있습니다.

페이지란 디스크와 메모리에서 데이터를 처리하는 최소 단위입니다. 일반적인 인덱스를 포함한 PK(클러스터 인덱스)와 테이블은 모두 페이지 단위로 관리됩니다.
따라서 만약 쿼리를 통해 1개의 레코드를 읽고 싶더라도 결국은 하나의 블록을 읽어야 하는 것입니다.

그래서 페이지에 저장되는 개별 레코드 데이터의 크기를 최대한 작게하여 1개의 페이지에 많은 데이터들을 저장할 수 있도록 하는 것이 중요합니다.
페이지에 저장되는 데이터의 크기가 크면 아래와 같은 문제가 발생할 수 있습니다.

- 디스크 I/O 증가
- 메모리 캐싱 페이지 수 감소

B-Tree의 노드에서는 (인덱스, PK) 쌍으로 저장합니다. 즉, 인덱스를 통해서 PK 값을 찾고, PK 값을 통해 정확한 레코드를 찾는 것입니다.
이러한 두 가지의 작업을 수행을 통해서 인덱스로 데이터를 조회하는 것입니다.

이러한 두 가지 작업을 수행하기 때문에 테이블을 직접 읽는 방법보다 비용이 더 발생합니다. 하지만, DBMS에서 테이블을 직접 읽어 모든 테이블을 읽기에는 엄청난 리소스 소모가 발생하게 됩니다.
그렇기 때문에 인덱스를 사용해 레코드를 찾는 속도가 훨씬 빠릅니다. 반대로 읽어야 할 레코드의 건수가 전체 테이블 레코드의 20~25%를 넘어서면 인덱스를 이용하지 않는 것이 효율적입니다.
이런 경우에는 옵티마이저가 인덱스를 활용하지 않고 테이블 전체를 읽어서 처리합니다.

## B+Tree 인덱스

B+Tree는 B-Tree와 비슷하지만 개선점이 있습니다. 바로 리프 노드끼리 서로 연결리스트로 연결되어 있다는 점입니다.

이러한 특징을 통해서 B-Tree 보다 쉽게 범위 탐색이 가능합니다.

![B+Tree](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FlmNml%2FbtrhSZR4BuI%2FAAAAAAAAAAAAAAAAAAAAAJ52OYh7p9Ib3J7Xd4KxFH5FdYJSzlqf7CXU7JDFSYjX%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1759244399%26allow_ip%3D%26allow_referer%3D%26signature%3DuvshUJjwBo9zRExrjAV9gHwklOk%253D)

예시로 100~200 번 사이의 데이터를 조회한다고 하면, 100번 데이터를 조회한 이후에 연결된 리스트를 따라가면 순차적인 범위 탐색이 보다 쉽게 가능합니다.
정리해보자면 5가지의 개선된 모습이 있습니다.

- 검색 방법: 중간 노드에는 키만 저장되고, 리프 노드에 키와 값이 저장
- 포인터의 사용: 리프노드 끼리 연결리스트로 연결
- 범위 쿼리와 범위 검색: 리프노드만 따라가면 범위 검색 가능
- 순차 탐색 및 정렬: 연결된 리스트이기에 키들이 항상 정렬
- 메모리 사용: 데이터는 단말 노드에만 저장됨으로 메모리 효율이 좋음