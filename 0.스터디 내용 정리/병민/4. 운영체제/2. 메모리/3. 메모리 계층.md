# 메모리 계층

## 1. 레지스터(Register)

레지스터란 CPU가 요청을 처리하는데 필요한 데이터를 일시적으로 저장하는 다목적 공간입니다. 프로세서 내부에 있는 작은 공간으로 연산 제어, 디버깅 등의 목적으로 사용합니다.

## 2. 캐시 메모리(Cache Memory)

캐시 메모리는 CPU와 주기억장치(RAM) 사이에 위치한 초고속 저장장치입니다. 프로그램 실행 시 속도 병목 현상을 줄이고, CPU의 성능을 극대화하는 기술입니다.

![캐시 메모리](https://velog.velcdn.com/images/haron/post/2e4d5919-d0d9-4b04-b72c-11aa119c1b30/image.png)

### 1. 캐시 메모리의 필요성

- 메인 메모리 vs CPU 속도 차이: CPU 클럭 속도에 비해 RAM은 매우 느립니다.
- 자주 사용하는 데이터 가속: 메모리 지역성 때문에 최근에 쓰거나 읽은 데이터를 메인 메모리보다 빠르게 동작하도록 설계되었습니다.

### 2. 캐시 메모리의 구조와 종류

#### 계층적 구조(멀티 레벨 캐시)

- L1 캐시 (Level 1)
	- CPU 코어 내부, 매우 작음(수십 KB), 매우 빠름
	- 다시 데이터 캐시(L1 Data), 명령어 캐시(L1 Instruction)로 분리되기도 함
- L2 캐시 (Level 2)
	- L1보다 큼(수백 KB~수 MB), L1보다 약간 느림
	- 일반적으로 코어마다 별도거나, 공유 구조
- L3 캐시 (Level 3)
	- CPU 전체 또는 여러 코어들이 공유(수 MB 이상), L2보다 느리지만 메모리보다 훨씬 빠름

#### 캐시 메모리의 동작 원리

- 지역성(Locality) 원리
	- 시간적 지역성(Temporal Locality): 최근 접근한 데이터는 가까운 미래에도 다시 접근될 확률이 높습니다.
	- 공간적 지역성(Spatial Locality): 한 번 접근된 주소 주변의 데이터도 곧 접근될 확률이 높습니다.
- 요청 데이터를 먼저 캐시에서 찾고(hit), 없으면 메인 메모리에서 읽으며(cache miss), 이때 캐시도 갱신합니다.

이 원리를 이용해, 자주 사용되거나 인접한 데이터 블록을 캐시에 미리 저장해둡니다.
없다면(미스) RAM~디스크 등 더 느린 계층에서 데이터를 찾아 캐시에 복사하고, 캐시 덕분에 CPU는 느린 메모리 접근 없이, 대부분의 작업을 매우 빠르게 수행할 수 있습니다.

### 3. 주기억장치(Main Memory)

데이터를 임시적으로 저장하는 공간(RAM, DRAM 등)으로, 실행 중인 프로그램, 현재 처리 중인 데이터, 임시 결과 등을 보관하는 용도입니다.

휘발성이라는 특성이 존재하지만, 보조기억장치보다 빠른 읽기, 쓰기 속도를 제공합니다.

## Q&A

### 캐시간의 동기화는 어떻게 이루어지나요?

- 멀티코어 시스템에서는 각 코어별 캐시 내 데이터 일관성(coherency)을 유지해야 함
- 캐시 일관성 프로토콜(MESI)이 각 캐시가 동일 데이터의 변경에 반응하도록 보장
- CPU 간 버스 또는 특수 신호로 변경 사항을 동기화 처리

### 캐시의 공간 지역성은 어떻게 구현될 수 있을까요?

- 캐시 라인(Cache Line) 단위로 데이터를 가져오고 보관
- 한 번에 한 블록(일반적으로 32B~128B)이 캐시에 적재되어, 인접 데이터 사용 시 미리 가져온 데이터를 재활용할 수 있어 공간 지역성을 효과적으로 극대화할 수 있음

## Reference

https://blog.skby.net/%EC%BA%90%EC%8B%9C-%EC%9D%BC%EA%B4%80%EC%84%B1-%EC%9C%A0%EC%A7%80%EA%B8%B0%EB%B2%95/
https://velog.io/@haron/CPU-CPU-%EC%BA%90%EC%8B%9C-%EA%B3%84%EC%B8%B5-%EA%B5%AC%EC%A1%B0
https://parksb.github.io/article/29.html
https://blog.skby.net/%EC%BA%90%EC%8B%9C-%EC%82%AC%EC%83%81mapping-%EA%B8%B0%EB%B2%95/
