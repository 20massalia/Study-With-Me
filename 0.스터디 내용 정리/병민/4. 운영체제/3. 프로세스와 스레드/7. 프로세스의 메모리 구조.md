# 프로세스의 메모리 구조

하나의 프로세스는 실행되기 위해 운영체제로부터 여러 자원을 할당받습니다.  
그 중에서도 **메모리 구조**는 프로세스가 동작하는 방식과 성능에 직접적인 영향을 주는 중요한 요소입니다.  
프로세스의 메모리 구조는 크게 4가지 영역으로 구성됩니다.

![프로세스의 메모리 구조](https://i.imgur.com/HvlGH1o.png)

## 1. 코드 영역 (Code / Text Segment)
- **설명**: 프로그래머가 작성한 함수, 메서드 등의 **실행 코드** 가 CPU가 해석 가능한 기계어 형태로 저장되는 영역입니다.
- **특징**
	- 읽기 전용(Read-only) 속성을 가짐 → 실행 중에 코드가 변조되는 것을 방지
	- 모든 스레드가 이 영역을 **공유**
	- 프로그램이 시작되면 고정된 크기로 할당
- **예시**
	- C 언어의 `main()` 함수, 기타 로직 코드들
	- Java의 바이트코드(JVM 환경에서는 메서드 영역과 유사한 개념)

## 2. 데이터 영역 (Data Segment)
코드 실행 과정에서 **전역 변수**나 **정적 변수(static)** 가 저장되는 공간입니다.  
초기화 여부에 따라 다시 세부적으로 나뉩니다.

- `.data` : 초기값이 있는 전역 변수나 static 변수 저장
- `.bss` : 초기값이 없는 전역 변수나 static 변수 저장  
  (프로그램 시작 시 0으로 초기화)
- `.rodata` : 상수(`const`)나 문자열 리터럴 저장 (읽기 전용)

**특징**
- 프로그램 종료 시까지 유지
- 모든 스레드가 공유

## 3. 스택 영역 (Stack Segment)
- **설명**: 함수 호출 시 생성되는 지역 변수, 매개변수, 리턴 주소 등을 저장하는 **임시 메모리 공간**
- **특징**
	- LIFO(Last-In First-Out) 방식
	- 함수 호출이 끝나면 해당 스택 프레임이 제거
	- 각 **스레드마다 독립적으로 할당** (스레드 안전성 확보)
	- 크기가 초과되면 `Stack Overflow` 발생
- **예시**
	- 재귀 함수 호출 시 스택 프레임이 계속 쌓임

## 4. 힙 영역 (Heap Segment)
- **설명**: 실행 중 동적으로 생성되는 객체나 데이터가 저장되는 영역
- **특징**
	- `malloc`, `new`와 같은 동적 메모리 할당에 사용
	- 크기가 런타임에 유동적으로 변함
	- 할당한 메모리를 직접 해제(`free`, `delete`)해야 함 (Java, Python 등 GC 있는 언어는 자동 해제)
	- 모든 스레드가 공유
- **주의**
	- 메모리 누수(Leak) 가능성 존재
	- 동기화 문제 발생 가능

## 스레드의 자원 공유 구조

스레드는 **프로세스가 할당받은 자원을 활용하는 실행 단위**입니다.  
하나의 프로세스에 여러 스레드가 존재하면, 마치 동시에 여러 작업을 하는 것처럼 동작할 수 있습니다.  
예를 들어, 파일을 다운로드하면서 동시에 웹 브라우징을 하는 경우가 해당됩니다.

- 스레드끼리 **코드, 데이터, 힙 영역**은 공유
- 스택 영역만 **스레드별로 독립적으로 할당**
- 이렇게 함으로써 메모리 사용을 최소화하면서도 병렬 작업 가능

![스레드의 자원공유](https://gmlwjd9405.github.io/images/os-process-and-thread/thread.png)

## 메모리 구조 요약 그림

![멀티스레드 메모리 구조](https://gmlwjd9405.github.io/images/os-process-and-thread/multi-thread.png)


### 메모리 레이아웃과 운영체제 역할

운영체제는 각 프로세스마다 독립적인 가상 메모리 공간을 부여합니다.  
이 공간은 위에서 설명한 4가지 영역 외에도 **커널 영역**이 포함됩니다.

- **유저 영역(User Space)**: 코드, 데이터, 힙, 스택
- **커널 영역(Kernel Space)**: 시스템 콜, 드라이버, OS 내부 자료구조 관리

이러한 구조 덕분에 각 프로세스는 **메모리 독립성**을 보장받으며, 다른 프로세스의 메모리에 직접 접근할 수 없습니다.

---

## 면접에서 할만할 질문

1. **프로세스 메모리 구조의 4가지 영역과 각각의 특징을 설명해보세요.**
2. **스레드가 공유하는 메모리 영역과 독립적인 메모리 영역은 무엇인가요?**
3. **스택 오버플로우는 왜 발생하나요?**
4. **힙 영역에서 메모리 누수가 발생하는 이유와 방지 방법은 무엇인가요?**
5. **.data, .bss, .rodata 영역의 차이점을 설명해보세요.**
6. **동적 메모리 할당과 정적 메모리 할당의 차이는 무엇인가요?**
7. **가상 메모리에서 커널 영역과 유저 영역이 나뉘는 이유는 무엇인가요?**

## Reference

https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%E2%9A%94%EF%B8%8F-%EC%93%B0%EB%A0%88%EB%93%9C-%EC%B0%A8%EC%9D%B4
https://hackmd.io/@KangMoo/Bk5Z1c_en
