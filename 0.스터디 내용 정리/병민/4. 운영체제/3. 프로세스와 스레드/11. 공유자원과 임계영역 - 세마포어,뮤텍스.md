# 공유자원과 임계영역 - 세마포어, 뮤텍스

## 1. 공유자원(Shared Resource)
공유자원이란 여러 프로세스 또는 스레드가 동시에 접근할 수 있는 자원(메모리, 파일, 변수 등)을 의미합니다. 멀티스레딩/멀티프로세싱 환경에서 자원 경쟁이 발생하며, 동기화 문제가 필연적으로 등장합니다.

- 예시: 전역 변수, 파일, 네트워크 소켓, 데이터베이스 커넥션 등
- 문제점: 동시 접근 시 데이터 불일치, 충돌, 예측 불가한 결과 발생

## 2. 임계영역(Critical Section)
임계영역은 여러 스레드/프로세스가 동시에 접근하면 안 되는 코드 영역입니다. 공유자원에 대한 읽기/쓰기 작업이 임계영역에 해당합니다.

- 임계영역 내 동시 접근 → Race Condition(경쟁상태), Deadlock(교착상태) 등 발생
- 임계영역 보호를 위해 동기화(synchronization) 기법 필요

## 3. 동기화(Synchronization) 기법
동기화란 여러 실행 흐름이 공유자원에 안전하게 접근하도록 제어하는 기술입니다. 대표적으로 뮤텍스(Mutex), 세마포어(Semaphore), 모니터(Monitor) 등이 있습니다.

### 3.1 뮤텍스(Mutex)
뮤텍스는 Mutual Exclusion의 약자로, 한 번에 하나의 스레드만 임계영역에 진입할 수 있도록 하는 락(lock) 객체입니다.

- 소유권이 존재(Owner): 락을 획득한 스레드만 해제 가능
- 바이너리 상태(locked/unlocked)
- 프로세스/스레드 간 상호배제(Mutual Exclusion) 보장
- Deadlock 위험: 락을 여러 개 중첩 획득 시 교착상태 발생 가능

![뮤텍스](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2Fcvk7nh%2FbtrjvSw2BoX%2FAAAAAAAAAAAAAAAAAAAAAA9iF5UH4mnKOS0piBCOy-VVZZhJKk18cIHt3JhH_x1k%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3DNpvDDKhXKBE1S82g8uz%252BQKNiq2o%253D)

E.g. 키가 하나만 있는 화장실

### 3.2 세마포어(Semaphore)
세마포어는 임계영역에 동시에 진입 가능한 스레드/프로세스의 수를 제한하는 카운터 기반 동기화 객체입니다.

- 값이 0이면 진입 불가, 양수면 진입 가능
- 소유권 없음: 누구나 해제 가능
- 바이너리 세마포어(값 0/1, 뮤텍스와 유사), 카운팅 세마포어(값 n)
- 프로세스 간 동기화에도 사용 가능

![세마포어](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FcYZOiu%2FbtrjvrzaimS%2FAAAAAAAAAAAAAAAAAAAAAHtr4M1GyNfHUSTY-xd5G07DB2a0TGELgm7mWdn5yBwT%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3D6WONNbCGYB%252F9zKj3E%252Bkrimuk%252BYE%253D)

E.g. 빈 칸 개수를 보여주는 전광판이 있는 화장실

#### 뮤텍스와 차이점

- 세마포어에는 조건변수가 없고 프로세스가 세마포어 값을 수정할 때 다른 프로세스는 동시에 세마포어 값을 수정할 수 없다.
- 뮤텍스는 한 개의 프로세스 또는 스레드만의 임계영역접근을 처리하지만 세마포어는 여러 개의 임계영역접근을 처리할 수 있다.

### 3.3 모니터(Monitor)

모니터는 공유자원은 내부적으로 숨기고 인터페이스를 통해 접근가능하도록 해 프로세스 간에 동기화 시킵니다.

![모니터](https://hudi.blog/static/b21097243917a89f36a4ca0031b129dc/41b39/monitor.png)

## 4. 동기화 문제와 해결
### 4.1 데드락(Deadlock)
여러 스레드/프로세스가 서로 자원을 점유한 채 상대방의 자원을 기다리며 무한 대기하는 현상
- 해결: 락 획득 순서 통일, 타임아웃, 교착상태 탐지 알고리즘 등

### 4.2 레이스 컨디션(Race Condition)
여러 실행 흐름이 동시에 공유자원에 접근해 결과가 예측 불가
- 해결: 임계영역 최소화, 락/세마포어/모니터 등 동기화 기법 적용

## 5. 하드웨어/OS 수준 동기화
- 원자적 연산(Atomic Operation): CAS(Compare-And-Swap), Test-and-Set 등
- CPU/메모리 버스에서 락 신호, 캐시 일관성 프로토콜(MESI, MOESI)
- 커널/유저 레벨 락: 커널 락은 시스템 콜, 유저 락은 라이브러리/언어에서 구현

## 6. 면접에서 자주 나오는 질문
1. 임계영역이란 무엇이며, 왜 필요한가?
2. 뮤텍스와 세마포어의 차이점은?
3. 데드락과 레이스 컨디션의 원인과 해결 방법은?
4. 자바에서 동기화는 어떻게 구현되는가?
5. 하드웨어 수준의 동기화(atomic, CAS 등)는 어떻게 동작하는가?
6. 멀티코어 환경에서 캐시 일관성은 어떻게 보장되는가?

## Reference
https://gmlwjd9405.github.io/2018/10/27/mutex-semaphore.html
https://inpa.tistory.com/entry/OS-%F0%9F%92%BB-%EB%AE%A4%ED%85%8D%EC%8A%A4-%EC%84%B8%EB%A7%88%ED%8F%AC%EC%96%B4-%EC%B0%A8%EC%9D%B4
https://hackmd.io/@KangMoo/Bk5Z1c_en

