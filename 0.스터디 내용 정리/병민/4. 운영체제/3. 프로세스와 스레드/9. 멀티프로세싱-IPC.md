# 멀티 프로세싱

멀티 프로세싱은 하나의 컴퓨터 시스템에서 여러 개의 프로세스가 동시에 실행되는 구조를 의미합니다. 
각 프로세스는 독립적인 메모리 공간과 자원을 할당받아 동작하며, 병렬 처리와 안정성 향상에 유리합니다.

### 특징

- 각 프로세스는 독립적으로 실행됨
- 하나의 프로세스가 오류로 종료되어도 다른 프로세스에 영향 없음
- CPU 코어가 여러 개일 때 병렬 처리 성능 극대화

### 장점

- 안정성: 프로세스 간 격리로 시스템 전체 장애 방지
- 보안성: 메모리 공간 분리로 데이터 보호
- 병렬 처리: 멀티코어 환경에서 성능 향상

### 단점

- 자원 소모: 프로세스마다 메모리, 자원 할당 필요
- 통신 비용: 프로세스 간 데이터 교환이 복잡함(IPC 필요)
- 컨텍스트 스위칭 오버헤드

## Context Switching 과정

![Context Switching 과정](https://velog.velcdn.com/images/yoonuk/post/ba5772b3-73ca-40fa-b7f1-640e53e9d483/image.png)

1. CPU는 Process P1을 실행한다 (Executing)
2. 일정 시간이 지나 Interrupt 또는 system call이 발생한다. (CPU는 idle 상태)
3. 현재 실행 중인 Process P1의 상태를 PCB1에 저장한다. (Save state into PCB1)
4. 다음으로 실행할 Process P2를 선택한다. (CPU 스케줄링)
5. Process P2의 상태를 PCB2에서 불러온다. (Reload state from PCB2)
6. CPU는 Process P2를 실행한다. (Executing)
7. 일정 시간이 지나 Interrupt 또는 system call이 발생한다. (CPU는 idle 상태)
8. 현재 실행 중인 Process P2의 상태를 PCB2에 저장한다. (Save state into PCB2)
9. 다시 Process P1을 실행할 차례가 된다. (CPU 스케줄링)
10. Process P1의 상태를 PCB1에서 불러온다. (Reload state from PCB1)
11. CPU는 Process P1을 중간 시점 부터 실행한다. (Executing)

## Context Switching Overhead

이러한 컨텍스트 스위칭 과정은 사용자로금 빠른 반응성과 동시성을 제공하지만, 실행되는 프로세스의 변경 과정에서 프로세스의 상태, 레지스터 값 등이 저장되고 불러오는 등의 작업이 수행하기 때문에 시스템에 부담을 주게됩니다.

위의 컨텍스트 스위칭 과정 그림을 보면 P1이 Execute에서 idle이 될 때 P2가 바로 Execute가 되지 않고 idle을 상태에 조금 있다가 Execute가 되는걸 볼 수 있습니다. 이 간극이 컨텍스트 스위칭 오버헤드(overhead)입니다.

![Context Switching Overhead](https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR9KBam_R8zpltmVa0gsYNPWIDzryExOckhuQ&s)

컨텍스트 스위칭 과정에서 PCB에 저장하고 복원하는데 비용이 발생하며, 프로세스 자체가 교체되는 것이니 CPU 캐시 메모리 데이터가 무효화됩니다. 이 과정에서는 메모리 접근 시간이 늘고, 성능저하가 발생할 수 있습니다.

컨텍스트 스위칭은 프로세스 뿐만 아니라 스레드 끼리도 일어납니다.

컨텍스트 스위칭 오버헤드라는 변수 때문에 스레드 교체 과정에서 과하게 오버헤드가 발생하면 오히려 멀티 스레드가 싱글 스레드보다 성능이 떨어지는 현상이 발생할 수 있습니다.
즉, 항상 멀티스레드 방식이 싱글 스레드보다 성능이 좋은 것은 아닙니다.

이러한 각 스레드에 대한 정보도 PCB처럼 TCB(Thread Control Block)으로 PCB 내부에 있습니다.
또한, 이러한 스레드 간의 자원공유를 뮤텍스, 세마포어와 같은 동기화 기법을 사용해 관리합니다.

## IPC(Inter-Process Communication)

IPC는 프로세스 간의 통신이 이루어지는 것입니다. 기본적으로 하나의 프로세스는 독립적이기 때문에 타 프로세스에 직접적인 접근이 불가능합니다.
하지만, OS의 커널이 IPC를 제공하며 각 프로세스들이 동시에 접근 가능한 공유 메모리 영역을 통해 데이터를 공유할 수 있도록 제공하고 있습니다.

![5 IPC](https://assets.bytebytego.com/diagrams/0234-inter-process-communication.png)

이러한 구조에서 추가적으로 세마포어는 이러한 프로세스간 데이터를 동기화하고 보호하는 역할의 방법입니다.

세마포어: 공유된 자원에 여러개의 프로세스가 동시에 접근하지 못하고, 한 번의 하나의 프로세스만 접근가능.

## Reference

https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%E2%9A%94%EF%B8%8F-%EC%93%B0%EB%A0%88%EB%93%9C-%EC%B0%A8%EC%9D%B4#pcb_process_control_block
https://tiptapcoding.tistory.com/entry/etc-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%EA%B0%84-%ED%86%B5%EC%8B%A0-IPC%EC%9D%98-%EA%B0%9C%EC%9A%94%EC%99%80-%EC%A2%85%EB%A5%98

