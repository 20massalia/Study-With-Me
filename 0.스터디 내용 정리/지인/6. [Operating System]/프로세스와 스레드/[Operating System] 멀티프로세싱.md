# 멀티 프로세싱

## 멀티 프로세싱

### 개념

멀티 프로세싱은 하나의 프로그램을 **여러 프로세스**로 나누어 **병렬로 작업**을 처리하도록 하는 방식입니다.

각 프로세스는 **서로 독립적인 메모리 공간**을 가지므로, 한 프로세스에서 문제가 발생해도 다른 프로세스에 직접적인 영향이 미치지 않습니다.

다만 데이터 교환이 필요하므로 **프로세스 간 통신(IPC)** 기법을 사용합니다.

대표적으로 **파일, 파이프/네임드 파이프, 메시지 큐, 공유 메모리, 메모리 맵, 소켓** 등을 사용합니다.

### 종류

- **대칭 멀티 프로세싱(SMP)**: 마스터–슬레이브 구분 없이, 운영체제와 사용자 스레드가 모든 CPU에서 실행 가능합니다. 현대 멀티프로세서 시스템의 표준에 가깝습니다.
- **비대칭 멀티 프로세싱(AMP)**: 일반적으로 **마스터 CPU**가 운영체제·스케줄링을 담당하고, 다른 CPU가 작업을 위임받아 수행합니다. 임베디드나 이종 프로세서 구성에서 사용되는 경우가 많습니다.

### 장점

- 프로세스 간 **격리**가 보장되어 **안정성**이 높습니다.
- 멀티 스레드 대비 **자원 보장 범위**(독립 주소 공간, 페이지 테이블 등)가 큽니다.
- **대용량·고비용 연산**을 병렬화하여 처리 시간을 단축하기에 적합합니다.

### 단점

- **IPC 오버헤드**가 존재하며 구현이 상대적으로 복잡합니다.
  - 데이터 복사, 커널 진입 등 비용 발생
- 프로세스마다 주소 공간을 따로 갖기 때문에 **메모리 사용량**이 증가합니다.

<br/>

## 멀티 스레딩

### 개념

멀티 스레딩은 **한 프로세스 내부**에서 여러 스레드가 **코드, 데이터, 힙을 공유**하며 작업을 나누어 수행합니다.

공유를 통해 자원 중복을 줄이고, **스레드 간 통신 비용**이 상대적으로 저렴합니다.

각 스레드는 **자신만의 스택**과 **레지스터 문맥**을 가집니다.

### 장점

- 동일 주소 공간 공유로 **메모리 낭비 감소** 및 **저렴한 통신**이 가능합니다.
- **생성·전환 비용이 프로세스보다 작고**, I/O bound 작업에서 응답성 향상에 유리합니다.
- 멀티코어에서 **동시 실행**로 처리량을 높일 수 있습니다.

### 단점과 보충 설명

- **스레드 과다(오버서브스크립션)**: 코어 수를 크게 초과하면 컨텍스트 스위칭이 늘고 캐시/메모리 지역성이 무너져 성능이 저하됩니다.
- **메모리·자원 압박**: 스레드마다 스택 메모리를 예약하고 TCB/커널 리소스를 소모하므로, 개수가 많아질수록 주소 공간과 물리 메모리 부담이 커집니다.
- **동기화 오버헤드**: 임계구역 경쟁으로 대기 시간이 증가하고, 스케줄러의 부하가 커집니다.
- **디버깅 난이도 증가**: 데이터 레이스, 데드락, 라이브락 등 동시성 버그로 인해 테스트·디버깅이 어려워집니다.
- **우선순위 이슈**: 우선순위 역전과 기아(starvation) 가능성이 존재합니다.

<br/>

## IPC (Inter-Process Communication)

프로세스는 **독립 주소 공간**을 가지므로 직접 메모리를 공유하지 않습니다.

커널이 제공하는 IPC로 데이터를 교환합니다.

### 파이프(익명/네임드)

- **익명 파이프**: 부모–자식 관계 등 **연관 프로세스 간** 단방향 통신에 주로 사용합니다.
- **네임드 파이프(FIFO)**: 파일시스템에 **이름을 갖는 특수 파일**로 만들어, **무관한 프로세스 간** 통신이 가능합니다.
  생성/오픈 방식만 다를 뿐 **I/O 동작 의미론은 동일**합니다.
  반이중(단방향) 특성을 가지며, 양방향이면 2개 파이프를 씁니다.

### 메시지 큐

**메시지 단위**로 송수신하는 큐입니다. 식별자(이름)를 통해 접근하며, **비동기 통신**과 **우선순위**를 지원합니다.

커널 오브젝트로 관리되며 파일 연산 유사 인터페이스를 제공합니다.

### 공유 메모리

여러 프로세스가 **같은 메모리 영역을 매핑**하여 가장 빠르게 데이터를 교환합니다.

단, **동기화(세마포어 등)** 를 반드시 병행해야 합니다. POSIX와 System V 두 계열이 있습니다.

### 메모리 맵(mmap)

디스크 **파일(또는 장치)의 일부/전체를 가상 메모리에 매핑**하는 방식입니다

**파일 기반 공유**가 가능하며, **익명 매핑(MAP_ANONYMOUS)** 은 파일 없이 메모리만 매핑합니다.

- **공유 메모리 vs 메모리 맵**
  - **공유 메모리**는 전용 공유 객체(shm)를 만들어 매핑합니다.
  - **메모리 맵 파일**은 **실제 파일을 등뼈로** 매핑하여, 여러 프로세스가 같은 파일 영역을 **MAP_SHARED**로 매핑하면 곧바로 **데이터 공유**가 됩니다.
  - 즉, **“대상”이 다릅니다.** 공유 메모리는 전용 공유 객체, 메모리 맵은 일반 파일(또는 익명)입니다. 또한 **MAP_PRIVATE/SHARED**에 따라 쓰기 전파(copy-on-write) 여부가 달라집니다.

### 소켓

네트워크를 통한 프로세스 간 통신을 제공합니다.

같은 호스트 내부에서는 **Unix Domain Socket(UDS)**으로 커널 내에서 고속 IPC를, 네트워크 간에는 **TCP/UDP 소켓**을 사용합니다.

<br/>
<br/>

> 참고
>
> - https://mysterlee.tistory.com/57
> - https://mysterlee.tistory.com/104
> - https://en.wikipedia.org/wiki/Symmetric_multiprocessing?utm_source=chatgpt.com
