# IP

## IP(Internet Protocol)이란?

**인터넷 프로토콜(IP, Internet Protocol)**은 송신 호스트와 수신 호스트가 해킷 교환 네트워크(Packet Switching Network)에서 정보를 주고받는 데 사용하는 **정보 위주의 프로토콜**입니다.

OSI 네트워크 계층(3계층)에서 **호스트의 주소지정**과 **패킷 분할 및 조립 기능**을 담당합니다.

집 주소가 있어야 우편을 보낼 수 있듯이, 네트워크에 접속된 각 컴퓨터에도 고유한 식별 번호가 있어야 정확하게 데이터를 송수신할 수 있습니다.

따라서 인터넷에 연결된 모든 컴퓨터에는 고유 주소가 부여되는데, 이 주소가 바로 IP입니다.

<br/>

## IP의 특징

**1. 비연결성 (Connectionless)**

- IP 프로토콜은 **별도의 연결 과정 없이 데이터그램을 독립적으로 전송**합니다.
  각 패킷은 서로 독립적으로 처리되며, 전송 전에 연결을 확립하지 않아 효율적이지만, 데이터가 실제로 도달하는지는 보장하지 않습니다.

**2. 비신뢰성 (Unreliable)**

- Best-Effort 서비스만 제공하며, **데이터그램의 전송 성공, 순서, 중복, 유실 여부를 보장하지 않습니다**.
  중간에 패킷이 유실되거나 순서가 바뀌어도 IP 자체에서는 감지하거나 수정하지 않습니다.

**3. 데이터그램 방식**

- 데이터를 **작은 패킷(데이터그램) 단위로 나누어 전송**합니다.
  각 데이터그램은 **독립적으로 라우팅**되며, 목적지에 도달하는 경로가 서로 다를 수 있습니다.

**4. 주소 지정 (Addressing)**

- **네트워크의 각 장치에 고유한 IP 주소를 할당**하여, 데이터가 올바른 위치로 전달되게 합니다.
  주소 체계는 IPv4(32비트)와 IPv6(128비트)가 대표적입니다.

**5. 패킷 분할 및 재조립 (Fragmentation & Reassembly)**

- 네트워크의 MTU(Maximum Transmission Unit)를 초과하는 크기의 데이터는 **여러 개의 조각으로 분할(Fragmentation)되고, 최종 목적지에서 재조합(Reassembly)**됩니다.
  이는 네트워크 종류에 따라 다양한 MTU에 유연하게 대응하기 위함입니다.

**6. 캡슐화와 헤더 사용**

- IP 데이터그램은 **헤더와 페이로드로 구성**됩니다.
  헤더에는 송신지 및 목적지 IP 주소, TTL, 프로토콜 정보 등이 포함되어 있습니다.
  헤더 체크섬을 통해 오류 검출을 할 수 있으나, IPv6는 처리 효율을 위해 체크섬을 생략합니다.

**7. 라우팅 기능**

- **경로 제어 및 네트워크 구간 내 데이터그램 전달을 담당**합니다.
  라우터들은 각 데이터그램을 분석하여 최적의 경로로 패킷을 전달합니다.

<br/>

## IP 주소 체계

### IPv4 주소 체계

- IPv4는 32비트의 주소 공간을 사용하며, 약 43억개의 고유한 주소가 존재합니다.
- 주소 형식은 4개의 8비트(1바이트) 필드로 구성되며, 각 필드는 0~255의 값을 가집니다.
  (예: 192.168.0.1)
- 네트워크와 호스트 부분으로 주소가 나뉩니다.
  네트워크 규모에 따라 A~D 클래스별로 사용되었지만, 현재는 **CIDR**(Classless Inter-Domain Routing) 방식으로 세분화되어 유연하게 운용됩니다.
- IP 고갈 문제로 인해 글로벌 레벨에서는 더 이상 새로운 IPv4를 충분히 제공하지 못하고 있습니다.
- **서브넷**과 **서브넷 마스크**를 사용해 네트워크를 논리적으로 더 세분화할 수 있습니다.

### IPv6 주소 체계

- IPv6(Internet Protocol version 6)는 128비트의 주소 공간으로, 사실상 무한대에 가까운 개수의 고유 주소를 제공합니다.
- 주소 표기 방식은 콜론(:)으로 구분된 여덟 개의 16비트 필드(16진수) 형태입니다.
  (예: 2001:0db8:85a3:08d3:1319:8a2e:0370:7334)
- IPv4에서 존재하던 브로드캐스트 개념은 IPv6에서 사라지고 멀티캐스트가 이를 대체합니다.
- 주소 공간을 넓힘으로써, 사설 네트워크나 각종 IoT 기기 등 미래의 다양한 전자기기에 모두 고유 주소를 할당할 수 있게 되었습니다.

### DHCP (Dynamic Host Configuration Protocol)

- **DHCP**는 네트워크에 연결된 장치(호스트)에 IP 주소, 서브넷 마스크, 게이트웨이, DNS 등 네트워크 정보들을 자동으로 할당해주는 프로토콜입니다.
- DHCP 동작 과정(DORA: Discover, Offer, Request, Ack)
  - **Discover**: 클라이언트가 DHCP 서버를 찾아 브로드캐스트 신호를 보냄
  - **Offer**: DHCP 서버가 사용할 수 있는 IP 정보를 제안
  - **Request**: 클라이언트가 제안받은 IP 사용 의사 전달
  - **Acknowledge**: DHCP 서버가 IP 할당을 확정
- DHCP를 사용하면 네트워크 관리의 효율성이 크게 향상되며, IP 주소 관리의 오류나 중복을 방지할 수 있습니다.
- 기업, 카페, 학교 등 다양한 환경에서 이동 사용자 또는 임시 접속 디바이스의 동적 IP 관리에 널리 쓰입니다.

### NAT (Network Address Translation)

- NAT(네트워크 주소 변환)은 하나의 공인 IP 주소를 여러 사설(내부) 네트워크 장치와 공유하도록 해주는 기술입니다.
- 외부 인터넷에는 NAT 라우터의 공인 IP만 노출되며, 내부 네트워크의 여러 장치는 각각의 사설 IP를 사용해 통신합니다.
- 패킷이 외부로 나가거나 들어올 때 NAT 라우터는 출발지 또는 목적지 IP 주소(및 포트 번호)를 해당 매핑 테이블에 따라 변환합니다.
  이를 통해 여러 내부 호스트가 하나의 공인 IP를 공유할 수 있습니다.
- **장점**
  - 주소 공간 절약(IP 고갈 문제 완화)
  - 내부 네트워크의 구조/주소 변경이 외부에 영향 없음
  - 내부 IP의 노출이 없어 보안성이 향상됨
- 주로 가정용 공유기, 기업 및 기관의 내부 네트워크에서 사용됩니다.

<br/>

## ARP(Address Resolution Protocol)

ARP(Address Resolution Protocol)는 네트워크에서 **IP 주소를 해당하는 장치의 물리적 주소(MAC 주소)로 변환해주는 프로토콜**입니다.

주로 이더넷 등 근거리 네트워크에서 단말 간 데이터 전달을 위해 사용되며, 같은 네트워크 내부(**LAN**)에서 IP만 알고도 대상 장치의 MAC 주소를 알아내 직접 통신할 수 있습니다.

### 주요 동작 원리

- **IP 주소와 MAC 주소 매핑**
  네트워크 상에서 데이터를 전송할 때, 목적지 IP 주소에 맞는 실제 MAC 주소를 알아야 데이터가 올바른 장치로 도달할 수 있습니다.
  ARP는 이 변환 작업을 담당합니다.
- **ARP 요청(Request)**
  송신 장치가 목적지 IP에 맞는 MAC 주소를 모를 때, 네트워크 전체에 브로드캐스트 방식으로 "누가 이 IP를 가지고 있습니까?"라고 묻는 요청을 보냅니다.
- **ARP 응답(Reply)**
  해당 IP 주소를 가진 장치가 자신의 MAC 주소를 포함해 응답을 보내주고, 송신자는 이 정보를 이용해 데이터 전송을 완료합니다.
- **ARP 테이블(캐시)**
  각 장치는 최근 매핑된 IP-MAC 정보를 일정 시간 저장해 두어, 반복적으로 변환 작업을 하지 않도록 효율을 높입니다.

### 추가 정보

- 반대로 MAC 주소로 IP를 찾는 프로토콜은 RARP(Reverse ARP)입니다.
- ARP 프로토콜은 단순 구조이지만, 보안상 ARP 스푸핑 등 공격의 대상이 될 수 있으니 주의가 필요합니다.

<br/>

## 홉바이홉 통신

### 홉바이홉 통신이란?

홉바이홉 통신이란 IP 네트워크에서 데이터 패킷이 최종 목적지에 도달하기까지 **여러 라우터나 장비를 거쳐 전송되는 방식**입니다.

여기서 ‘홉(hop)’은 패킷이 한 네트워크 장비(주로 라우터)에서 다음 장비로 넘겨지는 단계를 뜻합니다.

각 패킷은 노드에서 노드로, 즉 한 단계씩 건너뛰며 전송됩니다.

### 라우팅 테이블

- **라우팅 테이블**은 라우터나 네트워크 장치에 저장되는 데이터 표로, 각 패킷의 목적지 IP 주소에 따라 패킷을 어떤 경로로 전달해야 하는지 결정하는 정보를 담고 있습니다.
- 장비는 라우팅 테이블을 참조해 “어떤 목적지 주소는 어디로 보낼지”를 결정하며, 패킷이 최적의 경로로 목적지까지 도달하도록 합니다.
- 주요 구성 요소:
  - 목적지 네트워크 주소
  - 서브넷 마스크
  - 다음 홉(Next Hop) 또는 게이트웨이 주소
  - 인터페이스(네트워크 장치의 포트)
  - 메트릭(경로의 우선순위 값)

### 게이트웨이

- **게이트웨이**는 서로 다른 네트워크 간 통신을 가능하게 하는 관문 역할을 하는 장치나 소프트웨어입니다.
- 같은 네트워크(로컬 네트워크) 내 장치끼리는 직접 통신이 가능하지만, 다른 네트워크로 패킷을 보내려면 게이트웨이를 거쳐야 합니다.
- 흔히 사용자의 컴퓨터나 스마트폰 등에서 외부 인터넷으로 데이터를 보낼 때, 집·회사 네트워크의 인터넷 공유기(라우터)가 게이트웨이 역할을 합니다.
- 게이트웨이는 데이터의 포맷/프로토콜을 변환하거나, 내부 주소와 외부 주소를 연결하는 등 다양한 역할을 수행합니다.

<br/>

## DNS (Round Robin)

DNS 라운드 로빈은 **하나의 도메인 이름에 여러 개의 IP 주소를 등록**해, **사용자의 요청이 들어올 때마다 순차적(혹은 순환적)으로 다른 IP 주소를 반환**하는 부하 분산 기법입니다.

로드밸런서 등 별도의 하드웨어 없이도 **DNS 서버만을 이용해 간단하게 구현**할 수 있습니다.

### 작동 방식

- 여러 서버가 같은 서비스를 제공하는 환경에서, 도메인에 여러 IP를 등록합니다.
- 사용자가 해당 도메인으로 요청을 보내면 DNS 서버가 여러 등록된 IP 중 하나를 선택해 응답합니다.
- 이후 들어오는 사용자 요청에는 다음 순서의 IP를, 그다음에는 또 다른 IP를 반환하는 식으로 서버 간 트래픽을 분산시킵니다.
- 결과적으로 각 서버에 고르게 트래픽이 분배되어 서버 부하가 쉽게 균형을 이룹니다.

### 특징

- **간단한 부하 분산:** 트래픽이 여러 서버로 나뉘어 서버 과부하를 예방할 수 있습니다.
- **추가 장비 불필요:** 별도의 로드밸런서 없이 DNS만으로 구현 가능해 비용과 관리가 용이합니다.
- **서비스 가용성 향상:** 한 서버 장애 시에도 나머지 서버가 서비스를 지속 제공할 수 있습니다.
- **모든 도메인 기반 서비스에 적용 가능:** 웹, 메일, FTP 등 다양한 서비스에 적용 가능하며 관리가 쉽습니다.

### 한계 및 주의사항

- 서버의 실제 상태(다운 여부, 트래픽 상태 등)를 DNS가 자동으로 확인하지 않으므로, 장애 서버의 IP도 응답에 포함될 수 있습니다.
- DNS 응답 결과가 클라이언트나 중간 네트워크 장비(프록시, 게이트웨이 등)에 캐시될 수 있어, 트래픽 분산 효과가 100% 이상적으로 이뤄지지 않을 수 있습니다.
- 고가용성이 꼭 필요한 서비스에서는 Health Check 기능이 있는 고급 로드밸런싱 장치를 함께 사용하는 것이 권장됩니다.

<br/>
<br/>

> 참고
>
> - https://www.ibm.com/docs/ko/aix/7.3.0?topic=protocols-internet-protocol
> - [https://ko.wikipedia.org/wiki/인터넷\_프로토콜](https://ko.wikipedia.org/wiki/%EC%9D%B8%ED%84%B0%EB%84%B7_%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C)
> - https://seosh817.tistory.com/33
> - https://aws-hyoh.tistory.com/70
> - https://www.fortinet.com/kr/resources/cyberglossary/what-is-arp
> - [https://ko.wikipedia.org/wiki/주소*결정*프로토콜](https://ko.wikipedia.org/wiki/%EC%A3%BC%EC%86%8C_%EA%B2%B0%EC%A0%95_%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C)
> - https://seonghye0n.tistory.com/43
> - [https://velog.io/@jiyaho/CS-네트워크-IP-주소ARP-홉바이홉-통신-IP-주소-체계](https://velog.io/@jiyaho/CS-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-IP-%EC%A3%BC%EC%86%8CARP-%ED%99%89%EB%B0%94%EC%9D%B4%ED%99%89-%ED%86%B5%EC%8B%A0-IP-%EC%A3%BC%EC%86%8C-%EC%B2%B4%EA%B3%84)
> - https://m.blog.naver.com/techtrip/221691155719
