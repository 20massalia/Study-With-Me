# PCB
운영체제는 동시에 여러 프로세스를 실행하는 것처럼 보이게 한다. 하지만 실제로는 CPU가 아주 빠르게 프로세스를 번갈아 실행한다.
이때 핵심 역할을 하는 것이 바로 `PCB(Process Control Block)`와 `컨텍스트 스위칭(Context Switching)`이다.

## 1. PCB(Process Control Block)
PCB는 운영체제가 프로세스를 관리하기 위해 저장하는 정보 묶음이다. 일종의 프로세스 “신분증”이자 “진행 상황 기록지” 역할을 한다.

PCB에 저장되는 주요 정보
- 프로세스 상태: 준비, 실행, 대기 등 현재 상태
- 프로그램 카운터(PC): 다음에 실행할 명령어의 주소
- CPU 레지스터 값: 연산 중인 데이터, 주소 정보
- 메모리 관리 정보: 코드, 데이터, 스택의 메모리 위치
- 입출력 상태 정보: 열린 파일, I/O 요청 정보
- 프로세스 식별자(PID): 프로세스를 구분하는 고유 번호

정리: PCB는 “이 프로세스를 다시 실행하려면 여기 있는 정보대로 복구하면 된다”는 모든 자료를 담고 있다.

```text
┌───────────────────────────┐
│ Process ID (PID)          │  # 프로세스 고유 식별자
├───────────────────────────┤
│ Process State             │  # 준비(Ready), 실행(Running), 대기(Waiting) 등
├───────────────────────────┤
│ Program Counter (PC)      │  # 다음에 실행할 명령어 주소
├───────────────────────────┤
│ CPU Registers             │  # 연산 중인 데이터, 주소 등
├───────────────────────────┤
│ Memory Management Info    │  # 코드/데이터/스택 메모리 위치
├───────────────────────────┤
│ I/O Status Info           │  # 열린 파일, I/O 요청 정보
└───────────────────────────┘
```

## 2. 컨텍스트(Context)란?
컨텍스트는 프로세스가 실행 중이던 CPU 상태 + 메모리 상태를 말한다.
즉, "그 프로세스가 어디까지 실행했는지"를 나타내는 정보다.

- CPU 상태: 프로그램 카운터, 레지스터 값
- 메모리 상태: 스택, 힙, 데이터 영역의 내용

## 3. 컨텍스트 스위칭(Context Switching)이란?
컨텍스트 스위칭은 CPU를 사용하던 프로세스의 상태를 저장하고, 다른 프로세스의 상태를 복원하는 과정

컨텍스트 스위칭이 필요한 순간
- 타임 슬라이스(Time Slice) 종료 → CPU를 다른 프로세스에 넘길 때
- 더 높은 우선순위 프로세스가 도착했을 때
- 현재 프로세스가 I/O 요청으로 대기 상태로 전환될 때

## 4. 컨텍스트 스위칭 절차
1. 현재 실행 중인 프로세스의 컨텍스트 저장
    - PCB에 프로그램 카운터, 레지스터 값 등을 기록
2. 다음 실행할 프로세스 선택
    - 스케줄러가 Ready Queue에서 선택
3. 선택된 프로세스의 컨텍스트 복원
    - 해당 프로세스의 PCB에서 정보 읽어 CPU에 로드
4. 새 프로세스 실행 재개

```text
[현재 실행 중인 프로세스]
       │
       ▼
(1) 현재 CPU 상태 저장
    - PC, 레지스터 값 → PCB에 기록
       │
       ▼
(2) 스케줄러(Scheduler)가 다음 프로세스 선택
       │
       ▼
(3) 선택된 프로세스의 PCB 읽기
    - PC, 레지스터 값 복원
       │
       ▼
(4) 새 프로세스 실행 재개
```

## 5. PCB와 컨텍스트 스위칭의 관계
- PCB: 컨텍스트를 보관하는 저장소
- 컨텍스트 스위칭: PCB에 저장/복원하는 과정

## 6. 컨텍스트 스위칭의 비용
컨텍스트 스위칭은 오버헤드가 있다.
- 저장/복원 과정에서 CPU 시간이 소모됨
- 캐시 메모리 초기화로 성능 저하 가능
- 너무 잦으면 오히려 처리 효율이 떨어짐

그래서 운영체제는 `스위칭 빈도와 처리량(Throughput)`을 균형 있게 조절해야 한다.