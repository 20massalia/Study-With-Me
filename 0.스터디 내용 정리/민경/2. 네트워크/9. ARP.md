# IP 주소

> Internet Protocol Address 의 약자로, 네트워크 상에서 각 장치를 식별하기 위한 **논리 주소**

IPv4와 IPv6의 주소체계로 존재

* IPv4 : 32비트를 8비트 단위로 점을 찍어 표기
  `192.168.0.1`
* IPv6 : 64비트를 16비트 단위로 점을 찍어 표기
  `2001:0db8:85a3::8a2e:0370:7334`

IPv4로 할당할 수 있는 주소가 점점 부족해짐에 따라 IPv6로 확장하고 있지만,
아직까지 많아 사용하고 있는 주소체계는 IPv4

## 구조

IP 주소는 dot으로 구분된 8비트, 즉 1바이트를 4개 조합하며
보기 편함을 위해 10진수로 표기

	11111111.00000000.00000000.00000001 -> 255.0.0.1

이런 8비트(1바이트)의 영역을 **Octet** 이라고 부르며
8비트이기 때문에 Octet은 각각 0~255의 범위를 가짐

# MAC 주소

> Medis Access Control 의 약자로, 네트워크 인터페이스 카드에 부여된 고유 식별자. 즉 각 장치의 물리적인 주소

IP가 논리적인 주소라면 MAC은 물리적인 주소를 뜻하며,
주로 OSI계층 중 데이터 링크 계층에서 사용


## 구조

총 48비트, 6바이트로 구성되며 일반적으로 16진수로 표시
동일 네트워크 내에서 장치들을 식별하고 통신할 때 사용.

앞의 24비트 : 제조사 식별 변호 (Organizationally Unique Identifier, OUI)
뒤의 24비트 : 해당 제조사에서 고유하게 부여한 일렬번호

> `00:1A:2B:3C:4D:5E`
* `00:1A:2B` - 제조사
* `3C:4D:5E` - 디바이스 고유 번호

----

# ARP

앞에 IP주소와 MAC주소에 알아본 것 처럼, 하나의 장치에서 사용하는 주소는 논리적 / 물리적 주소 총 2개가 된다. <br>
각각 네트워크 계층과 데이터 링크 계층에서 필요한 주소가 되는데, 결국에는 모든 주소를 알아야 통신이 가능해진다.

데이터를 통신하기 위해 상대의 IP 주소를 알고 있다면, 상대의 MAC 주소는 어떻게 알 수 있을까?

이를 위해서 나온 프로토콜이 ARP 이다.

> Address Resolution Protocol, IP주소를 MAC 주소로 변환하는 프로토콜 <br>
OSI 7계층 중 네트워크 계층에 해당하며, IPv4 환경에서만 사용

1. 요청을 보내는 장치에서 ARP를 브로드 캐스트 진행


	🗣️ : 이 IP 주소를 가진 장치 누구야? MAC 주소를 알려줘

2. ARP를 받은 장치들은 해당 IP 주소가 본인 것인지 확인.


    👥 : IP 주소 누구꺼야 ..? (웅성웅성)..

3. 만약 본인이 해당된다면?


	🗣️ : 그 IP는 내 주소고, 내 MAC 주소는 ~~..      
4. 요청을 보낸 장치에게 MAC 주소와 함께 유니캐스트 진행
5. 요청을 받은 장치는 이제 MAC 주소까지 알았으니 **ARP 캐시**에 저장, 이후 프레임을 전송

---

## ARP Spoofing

> 공격자가 위조된 ARP Reply를 전송해, MAC 주소 정보를 속이는 공격 <br>
결과적으로 피해자의 ARP 캐시에 잘못된 정보가 저장되어, 공격자에게 트래픽이 전달

* 정상적인 ARP 흐름

물론 A의 ARP 프로토콜은 브로드 캐스트로 진행되지만 편리한 설명을 위해 생략

![](https://velog.velcdn.com/images/khhkmg0205/post/a94cac83-51c7-4535-aff5-b83ea78abf60/image.png)

ARP Reply를 통해 결과를 ARP 캐시에 저장.

### ARP 캐시

이미 전송된 내역이 있는 장치에 또 다시 MAC 주소를 얻기 위해 **지속적인 브로드캐스트를 진행하는 것은 상당한 자원을 소모함.**

따라서 이미 응답이 왔던 내역에 대해서는 **ARP 캐시 테이블에 저장**하여,
앞으로 캐시를 먼저 확인 후 이에 매핑되는 MAC 주소를 사용.

이런 특징을 가진 ARP 캐시를 통해 공격자가 위조한 ARP Reply를 A에게 지속적으로 넘겨주어
**잘못된 내용이 ARP 캐시에 저장되도록 하는것이 ARP Spoofing
**
* 비정상적인 ARP 흐름

![](https://velog.velcdn.com/images/khhkmg0205/post/78347461-d014-4f9f-af88-a99e80027f59/image.png)

실제 192.168.0.1의 GATEWAY는 응답하지 않았는데, 공격자가 ARP Reply를 악의적으로 A에게 보냄으로써 ARP 캐시에 GATEWAY의 MAC 주소가 `CC:CC:CC:CC:CC:CC`로 매핑됨.

이후 만약 A에서 192.168.0.1로 요청을 보내야 하는 상황이 온다면, ARP 캐시에 매핑된 `CC:CC:CC:CC:CC:CC`의 주인인 공격자에게 요청 패킷을 보내며

즉, 공격자는 패킷을 훔쳐보거나 수정하거나, 혹은 외부에서는 정상적인 척 GATEWAY에게 패킷을 전달함으로써 _MITM(Man-In-The-Middle)_ 공격을 진행할 수 있음

---

