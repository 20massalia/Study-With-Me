# 트랜잭션(Transaction)

## 1. 개념

-   **사전적 의미**: 거래\
-   **컴퓨터 과학에서의 의미**: 더 이상 분할할 수 없는 **업무처리
    단위**\
-   즉, 하나의 작업을 위해 반드시 함께 수행되어야 하는 명령들의 묶음

예: 계좌이체\
- 인출과 입금은 반드시 함께 성공하거나, 함께 실패해야 함\
- 한쪽만 실행되면 치명적 문제 발생 → **Atomic(원자성)** 보장 필요

------------------------------------------------------------------------

## 2. 트랜잭션의 필요성

-   데이터베이스에서 여러 연산을 수행하다가 도중에 오류가 발생할 수 있음
-   오류 발생 시, 일부만 반영되면 데이터 불일치가 발생
-   따라서 모든 연산을 하나의 트랜잭션으로 묶어 **모두 성공 시만 반영,
    실패 시 원상태 복구**

------------------------------------------------------------------------

## 3. SQL 트랜잭션 예시

``` sql
START TRANSACTION;
    -- 이 블록 안의 명령어들은 하나의 트랜잭션 단위로 실행됨
    -- 모두 성공하거나, 모두 실패해야 함
    UPDATE account SET balance = balance - 100 WHERE id = 'A';
    UPDATE account SET balance = balance + 100 WHERE id = 'B';
COMMIT;
```

-   `START TRANSACTION` : 트랜잭션 시작\
-   `COMMIT` : 모든 작업을 확정 (DB에 반영)\
-   `ROLLBACK` : 오류 발생 시 작업 전 상태로 되돌림

------------------------------------------------------------------------

## 4. MySQL 트랜잭션 특징

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FXeYCf%2FbtsQjWr0u5m%2FAAAAAAAAAAAAAAAAAAAAAGWyjfdWxly2n3s9Aqbhb73rAgI_I4OKR01wJxr_AcO5%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1759244399%26allow_ip%3D%26allow_referer%3D%26signature%3DAr9fz4CBOYVybPW4e%252Fxp1rqHQc8%253D)

-   MySQL의 `INSERT`, `DELETE`, `UPDATE`는 각각 **하나의 트랜잭션
    단위**\
-   기본적으로 **자동 커밋(Auto Commit)** 모드 → 실행과 동시에 DB 반영\
-   따라서 여러 SQL을 묶어서 하나의 단위로 실행하려면
    `START TRANSACTION` 필요

> 💡 git의 commit과 유사: DB의 상태를 특정 시점에 확정하는 것

------------------------------------------------------------------------

## 5. 작업 단위(트랜잭션 단위)

-   단위는 질의어 한 문장이 아니라, **여러 질의문을 묶은 것**\
-   개발자가 정의하는 기준에 따라 결정됨

예: 게시판 글 작성\
1. 사용자가 "올리기" 버튼 클릭\
2. 서버는 `INSERT` 문으로 글 데이터 저장\
3. 이후 게시판 화면을 최신화하기 위해 `SELECT` 실행\
   👉 `INSERT + SELECT` 두 동작이 **하나의 트랜잭션 단위**

------------------------------------------------------------------------

## 6. 요약

-   **트랜잭션**: 더 이상 분리할 수 없는 작업 단위\
-   **특징**: 모두 성공(Commit) or 모두 실패(Rollback)\
-   **MySQL**: 기본 Auto Commit, 필요 시 `START TRANSACTION`으로 묶음\
-   **중요성**: 데이터의 무결성과 안전성을 보장
