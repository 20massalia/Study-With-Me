# 프로세스와 컴파일 과정
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FbTrZVO%2FbtsPNnYHbqo%2FAAAAAAAAAAAAAAAAAAAAAP--zlZuC8UgxWNtfoeJXDZAyntxUgOGzfHuP7Bt_Lxo%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3De4HAU6lOdSrFWN8Bw5ttKCsqUYw%253D)
> 정의 : C언어에서의 컴파일 과정은 전처리기 -> 컴파일러 -> 어셈블러 -> 링커를 거쳐서
.exe 파일을 통해서 실행된다

---

## 1. 전처리기
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FdyioK8%2FbtsPLmUisS5%2FAAAAAAAAAAAAAAAAAAAAAAwcs1b5EOWEZsux4iJklh2iKH_xsZh0gPTwZhOyyTnx%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3D99O5yPCurlXq1yQG0VhS3XqrKp0%253D)
> 정의 : C 언어에서 전처리기는 소스 코드를 컴파일하기 전에 특정한 변환 및 처리 작업을 수행하는 도구이다.
전처리기 명령은 # 기호로 시작하며 주로 소스 코드의 특정 부분을 조건부 컴파일 하거나 매크로로 대체하는 등의 작업을 수행함.

### 01. 헤더 파일 포함 (#include)
- 외부에서 선언된 헤더 파일을 현재 소스코드에 포함시킨다. 이를 통해 다양한 라이브러리나 다른 소스 코드 파일에서 선언된 내용을 현재 파일에서 사용가능함.
```c
#include <stdio.h>
```

### 02. 매크로 정의(#define)
- 매크로는 코드 중복을 방지하고 가독성을 향상시키기 위해 사용됨
```c
#define PI 3.14
```

### 03. 조건부 컴파일 (#if, #ifdef, ...)

- DEBUG 매크로가 정의 되어 있으면 디버그 로그를 출력하는 LOG매크로를 정의하고
그렇지 않으면 LOG 매크로를 빈 문자열로 정의함

```c
#ifndef MATH_H
#define MATH_H
#define SQR(x) ((x) * (x))
#endif
```
- 전처리 전 c코드
```c
#include "math.h"
#define ADD(a,b) ((a) + (b))

int sum_sq(int a, int b) {
    return SQR(ADD(a, b));
}

int main(void) {
    return sum_sq(3, 4);
}
```

- 전 처리 후 c코드
```c
int sum_sq(int a, int b) {
    return (((a) + (b)) * ((a) + (b)));
}

int main(void) {
    return sum_sq(3, 4);
}
```

---

## 2. 컴파일러
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FcQilos%2FbtsPLF0nW3S%2FAAAAAAAAAAAAAAAAAAAAAKtAwf9JjPTF0IcX7Y-l98YvcM3832XVab9dxHlnKogH%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3D%252BSKzmz26Q9heyayFzReWmtfqGNU%253D)
> 정의 : 컴파일 과정에서 전처리된 소스 코드를 어셈블리 언어로 변환함.

- 어셈블리어 예시

```
	.intel_syntax noprefix
	.text
	.globl	sum_sq
sum_sq:
	push    rbp
	mov     rbp, rsp
	mov     DWORD PTR [rbp-4], edi     ; a
	mov     DWORD PTR [rbp-8], esi     ; b
	mov     eax, DWORD PTR [rbp-4]
	add     eax, DWORD PTR [rbp-8]     ; eax = a + b
	mov     edx, eax
	imul    eax, edx                   ; eax = (a+b)*(a+b)
	pop     rbp
	ret

	.globl	main
main:
	push    rbp
	mov     rbp, rsp
	mov     edi, 3                     ; a = 3
	mov     esi, 4                     ; b = 4
	call    sum_sq
	pop     rbp
	ret
```

---

## 3. 어셈블러
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2F05vPV%2FbtsPLjXxK3p%2FAAAAAAAAAAAAAAAAAAAAAFI9DWaOCdWG3aHsU5ztPLeTrNbsqstndhlX5wkiN4ca%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3DtoPyFQjSDB52LN%252FkH6zZOAEBNos%253D)
> 정의 : 어셈블 과정에서 어셈블리 언어로 작성된 목적 코드를 기계어로 변환함
그 결과로 목적코드를 생성한다

1. 목적 파일
- 어셈블러 목적 코드를 포함하는 목적파일을 생성함. 목적 파일을 여러 목적 섹션과 각 섹션의 정보를 포함한다.
일반적으로 바이너리 형식으로 저장된다. 이는 링크에 의해 여러 목적 파일이 결합되어 하나의 실행파일이 생성되기 전까지 완전한 프로그램이 아님.

2. 실행 파일
- linking이 완료된 후에 생성되며, 프로그램이 실제로 실행될 수 있는 형태이다. 링킹은 여러 목적 파일 하나로 결합하고, 주소를 조종하며,
연결을 수행하는 작업을 수행함. 컴퓨터의 운영체제에 의해 직접 실행 가능한 형태로 해석되어 프로그램이 메모리에 로드 되고 실행된다.

---

## 4. 링커
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FcNHq2Y%2FbtsPNMjBVgS%2FAAAAAAAAAAAAAAAAAAAAAIFGN3YybzTbrvNXdYRE1HUqd--bY-16MmDg2U7w4B2p%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3DgEe6ywmBHhIPIIwOY5mvEH2Dn2o%253D)
> 정의 : Linking은 각기 다른 목적 코드를 하나의 실행 파일로 묶는 연결 시켜주는 작업