# 컨텍스트 스위칭 요약

## 핵심 정의
- **컨텍스트 스위칭**: CPU/코어에서 실행 중이던 **프로세스/스레드**를 다른 실행 단위로 교체하는 것.
- **컨텍스트(문맥)**: 해당 실행 단위의 **상태**(CPU 레지스터, 스택 포인터, 프로그램 카운터 등)와 메모리 관점의 상태.

---

## 왜 필요한가
- 시간 분할로 **동시 실행처럼 보이게** 하기(응답성 향상).
- **공정한 CPU 시간 분배**(스케줄링).
- **우선순위가 높은 작업**의 빠른 응답.
- I/O 등 **대기 상태**에서 다른 작업을 진행.

## 언제 발생하나 (대표 트리거)

- **타임 슬라이스**(Time Quantum) 소진
- **I/O 요청** 또는 다른 **리소스 대기**
- **인터럽트(Interrupt)** 등

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FcjsUVo%2FbtssVVplUNC%2FAAAAAAAAAAAAAAAAAAAAABcZ8ylWKYwVmJiSvXqTqPBDIJIf7Ewu8_OCOG7jpdCK%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3DViI7vcxumSw3z2lzQ8fLQPJMrKE%253D)
- 위의 사진처럼 Time Quantum동안 프로세스가 1,2가 번갈아가면서 실행되고 있음. 매우 짧은 시간 동안 번갈아가면서
  실행되며 **동시에 실행**되는 것처럼 보이게 된다. 이렇게 프로세스가 바뀌는 것을 **컨텍스트 스위칭** 이라고 함

## 누가 수행하나
- **운영체제 커널**(커널 모드)에서 스케줄러/인터럽트 핸들러가 수행.

## 공통점 (프로세스/스레드 스위칭)
- 모두 **커널 모드**에서 실행됨.
  - 커널 모드 : 어느 프로세스가 실행되다가 HW와 밀접한 일들 혹은 컴퓨터에 있는 여러 리소스들을 다뤄야 하는 상황이 발생
  하면 프로세스가 직접 컴퓨터의 리소스에 접근하는 것이 아니라 운영체제를 통해 접근하게 되는데, 특히 운영체제에서도 커널을 통해서
  접근하게 됨. 이 프로세스에서 커널로 통제권이 넘어가서 커널에 의해 실행되는 것을 **커널 모드**라고 함.
- **CPU 레지스터 상태 저장/복구**(PC, SP 등).
  - 어떤 프로세스가 CPU에서 실행되고 있을 동안에, 레지스터에 있는 여러 값들이 계속 바뀌면서 실행되고 있음.
  이때, 다른 프로세스가 실행되면 실행되고 있던 프로세스의 레지스터 상태들을 어딘가에 저장을 하고 다른 프로세스가 실행되는 것.
  그래야지 다시 다른 프로세스가 실행됐을 때 그때의 상태 정보들을 알고 있어야 이어서 실행할 수 있기 때문.

## 차이점 (프로세스 vs 스레드)
- **프로세스 컨텍스트 스위칭**
  - 서로 **다른 주소 공간**으로 전환.
  - **MMU** 재설정 및 **TLB** 미스/플러시 발생 → 오버헤드 큼.
- **스레드 컨텍스트 스위칭**
  - **같은 프로세스의 주소 공간 공유**(Code/Data/Heap 공유).
  - 주로 **레지스터/스택 포인터** 전환이면 충분 → 오버헤드 작음.

## MMU(Memory Management Unit)와 TLB(Translation Lookaside Buffer)개념

- MMU는 가상 메모리와 물리 메모리 사이의 주소 변환을 담당합니다. 프로세스가 물리 메모리에서 할당되는 위치를 추상화하여 각 프로세스가 독립적인 주소 공간을 가지고 있는 것처럼 만듭니다.
- TLB는 MMU 내에 존재하는 캐시 메모리입니다. 가상 주소를 물리 주소로 변환하는 과정을 상대적으로 느릴 수 있기 때문에, 이러한 변환의 결과를 TLB에 저장해 두고 빠르게 사용하는 데에 목적이 있습니다.

## 컨텍스트 스위칭이 미치는 영향
- 컨텍스트 스위칭이 발생하면서, 캐시 오염(Cache Pollution)이라는 간접적인 영향이 발생합니다.
- 캐시란 데이터나 값을 임시 저장해 두는 임시 장소입니다. CPU가 자주 사용하는 것들에 대해서 매번 메모리에 접근하는 것이 아니라, 캐시에 저장해 두고 빠르게 데이터를 가져오기 위해 사용합니다.
- 컨텍스트 스위칭이 일어나면, 또 사용할 것이라고 예상을 하고 캐시에 데이터나 값을 저장한 캐시가 의미가 없는 데이터가 되어버립니다. 컨텍스트 스위칭이 일어난 직후에 캐시에 가봤자, 이전에 프로세스에서 실행되었던 정보들을 저장해놓고 있을 가능성이 매우 높기 때문에, 내가 필요한 정보는 없을 가능성이 매우 높아지기 때문입니다. 이러하다는 것은 성능적으로 손해를 보는 부분이 발생함

### 비교 요약 표
| 항목 | 프로세스 스위칭 | 스레드 스위칭 |
|---|---|---|
| 주소 공간 | 다름(전환 필요) | 동일(전환 불필요) |
| MMU/TLB | 재설정/플러시 필요 | 변화 거의 없음 |
| 저장/복구 | 레지스터 + PCB/메모리 맵 등 | 레지스터 + 스택 |
| 비용 | 상대적으로 큼 | 상대적으로 작음 |

## 부작용/영향
- **캐시 오염(Cache Pollution)** 및 **TLB 미스** 증가 가능 → 전환 직후 성능 저하.

## 한 줄 정리
- **프로세스 스위칭은 주소 공간까지 바뀌어 비싸고, 스레드 스위칭은 같은 주소 공간을 써서 더 싸다.**

Reference
- 컨텍스트 스위칭이 미치는 영향
  컨텍스트 스위칭이 발생하면서, 캐시 오염(Cache Pollution)이라는 간접적인 영향이 발생합니다.

캐시란 데이터나 값을 임시 저장해 두는 임시 장소입니다. CPU가 자주 사용하는 것들에 대해서 매번 메모리에 접근하는 것이 아니라, 캐시에 저장해 두고 빠르게 데이터를 가져오기 위해 사용합니다.
컨텍스트 스위칭이 일어나면, 또 사용할 것이라고 예상을 하고 캐시에 데이터나 값을 저장한 캐시가 의미가 없는 데이터가 되어버립니다. 컨텍스트 스위칭이 일어난 직후에 캐시에 가봤자, 이전에 프로세스에서 실행되었던 정보들을 저장해놓고 있을 가능성이 매우 높기 때문에, 내가 필요한 정보는 없을 가능성이 매우 높아지기 때문입니다. 이러하다는 것은 성능적으로 손해를 보는 부분이 발생한다는 거겠죠?