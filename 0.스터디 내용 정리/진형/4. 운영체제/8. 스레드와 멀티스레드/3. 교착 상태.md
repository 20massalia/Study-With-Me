# 교착 상태

> 정의 : 두 개 이상의 프로세스가 자원을 점유한 상태에서 서로 다른 프로세스가
점유하고 있는 자원을 요구하며, 서로의 작업을 끝나기만을 기다리며 둘 다 영원히 끝나지 않는 상태를 뜻함.

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FxVu3c%2FbtrEc3xU5u8%2FAAAAAAAAAAAAAAAAAAAAAF2NI_OBgM0m0UNVJD-5B21dc_sn7vpnseA8v6BW8Olc%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3Dx%252Fgb3YVEPJdWpEn2ZYg2pVPrbXE%253D)

---

# 교착 상태의 발생 조건 4가지

### - 교착상태는 아래의 4가지 조건이 모두 만족되는 경우에 발생할 가능성이 있음
### 하나라도 만족하지 않으면 교착상태가 발생하지 않는다.

## 1. 상호 배제 (Mutual Exclusion)
- 한 번에 한 개의 프로세스만이 공유자원을 사용할 수 있다

## 2. 점유 대기 (Hold and Wail)
- 프로세스가 할당된 자원을 가진 상태에서 다른 자원을 기다림

## 3. 비선점(No Preempiton)
- 프로세스가 작업을 마친 후 자원을 자발적으로 반환할 때까지 기다림
  (이미 할당된 자원을 강제적으로 빼앗을 수 없음)

## 4. 순환 대기(Circulat Wait)
- 프로세스의 자원 점유 및 점유된 자원의 요구 관계가 원형을 이루면서 대기하는 조건.
- 각 프로세스는 순환적으로 다음 프로세스가 요구하는 자원을 가지고 있음.

---

# 교착 상태 해결방법

## 1. 예방(Prevention)
- 예방 방법은 교착상태가 애초에 일어나지 않도록 방지하는 방법으로 교착상태의 발생조건 4가지 중 하나를 부정함으로써 교착상태를 예방하는 방법

### 1. 상호 배제 부정
### - 여러 개의 프로세스가 동시에 공유자원을 사용할 수 있음

### 2. 점유 대기 부정
### - 프로세스가 실행되기 전에 필요한 모든 자원을 할당하여 프로세스 대기를 없애거나, 자원이 점유되지 않은 상태에서만 자원 요청을 받도록 한다

### 3. 비선점 부정
### - 모든 자원에 대한 선점을 허용

### 4. 순환 대기 부정
### - 자원을 선형으로 분류하여 고유 번호를 할당하고, 각 프로세스는 현재 점유한 자원의 고유번호보다 앞이나 뒤 한쪽 방향으로만 자원을 요구하도록 함

## 2. 회피(Avoidance)
### - 교착상태가 발생할 가능성이 있는 자원 할당(Unsafe Allocation)을 하지 않고 안전한 상태(Safe state)
### 상태에서만 자원 요청을 허용하는 방법.

### - 하지만 교착상태 회피를 하기 위해서는 아래와 같은 가정이 필요함

### - 프로세스 수 고정
### - 자원의 종류와 수 고정
### - 프로세스가 요구하는 최대 자원의 수를 알아야 함
### - 프로세스는 자원 사용 후 반드시 반납

---

### 1. 은행원 알고리즘 (교착상태를 회피하기 위한 알고리즘)
- 다익스트라가 제안한 기법으로, 은행에서 모든 고객의 요구를 충족할 수 있도록 현금을 대출해주는 것에서 유래하였습니다.
은행원 알고리즘은 자원 할당 결정전에 예상되는 모든 자원의 최대 할당향을 가지고 시뮬레이션 하여 safe state에 들 수 있는지 여부를 검사하여
교착상태의 가능성을 미리 조사하는 알고리즘

- 기본 개념 자체는 "CPU"는 **최소한 하나의 프로세스에게 할당해줄 만큼의 자원을 항상 보유**하고 있어야함

# 은행가 알고리즘 예시 (Safe Sequence 확인)

시스템은 총 **12개의 자원**을 가지고 있다고 가정합니다.

---

## 초기 상태 (t = t0)

| 프로세스 | 최대 자원 요청량 | 할당 중인 자원량 | 남은 필요 자원량 |
|----------|------------------|------------------|------------------|
| P0       | 10               | 5                | 5                |
| P1       | 4                | 2                | 2                |
| P2       | 9                | 2                | 7                |

- 현재 할당 중인 자원량 합: `5 + 2 + 2 = 9`
- 시스템 총 자원: `12`
- 가용 자원량: `12 - 9 = 3`

---

## 자원 할당 과정

1. **남은 가용자원 3개를 P1에게 할당**
  - 가용 자원: `3 - 2 = 1`
  - P1 종료 후 자원 반납: `1 + 4 = 5`

2. **가용 자원 5개를 P0에게 할당**
  - 가용 자원: `5 - 5 = 0`
  - P0 종료 후 자원 반납: `0 + 10 = 10`

3. **가용 자원 10개 중 7개를 P2에게 할당**
  - 가용 자원: `10 - 7 = 3`
  - P2 종료 후 자원 반납: `3 + 9 = 12`

---

## 결과

- Safe Sequence: **P1 → P0 → P2**
- 모든 프로세스가 정상적으로 종료하며, 시스템은 안전 상태(Safe State)를 만족함.

---
Reference
- https://cocoon1787.tistory.com/858