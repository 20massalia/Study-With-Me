# 경쟁상태(Race Condition)

## 1. 경쟁상태란
경쟁상태(Race Condition)는 둘 이상의 프로세스 또는 스레드가 동시에 공유자원에 접근할 때, 실행 순서에 따라 결과가 달라지는 현상을 의미합니다. 즉, 동시성 환경에서 자원 접근이 제대로 동기화되지 않으면 예측 불가능한 결과나 오류가 발생할 수 있습니다.

- 예시: 두 스레드가 동시에 같은 변수에 값을 쓰거나 읽을 때, 실행 순서에 따라 값이 달라질 수 있음
- 주로 멀티스레딩, 멀티프로세싱 환경에서 발생

![경쟁상태](https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2Fz52TN%2FbtsbQyzihfJ%2FAAAAAAAAAAAAAAAAAAAAAHkuTmJvtMQPLNCa0lNk_dqUpkO_WKQbHlMcOukhVS98%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1756652399%26allow_ip%3D%26allow_referer%3D%26signature%3DKj%252BsariP%252F7ULSj9OjKUqWDHYgGY%253D)

![경쟁상태](https://i.sstatic.net/FDc5b.png)

## 2. 경쟁상태 발생 원인

#### Mutual exclusion
Race condition을 막기 위해서는 두 개 이상의 프로세스가 공용 데이터에 동시에 접근을 하는 것을 막아야 합니다.
즉, 한 프로세스가 공용 데이터를 사용하고 있으면 그 자원을 사용하지 못하도록 막거나, 다른 프로세스가 그 자원을 사용하지 못하도록 막으면 이 문제를 피할 수 있습니다. 
이것을 상호 배제(mutual exclusion)라고 부릅니다.
#### Deadlock
그러나 위와 같은 상호 배제를 시행하면 추가적인 제어 문제가 발생합니다. 하나는 교착상태 즉 여기서 말하는 Deadlock입니다.
프로세스가 각자 프로그램을 실행하기 위해 두 자원 모두에 엑세스 해야 한다고 가정할 때 프로세스는 두 자원 모두를 필요로 하므로 필요한 두 리소스를 사용하여 프로그램을 수행할 때까지 이미 소유한 리소스를 해제하지 않습니다.
이러한 상황에서 두 프로세스는 교착 상태에 빠지게 되는 문제가 발생할 수 있습니다.

#### Starvation
이 제어 문제는 ‘기아 상태’라고도 합니다. 이러한 문제는 프로세스들이 더 이상 진행을 하지 못하고 영구적으로 블록되어 있는 상태로,
시스템 자원에 대한 경쟁 도중에 발생할 수 있고 프로세스 간의 통신 과정에도 발생할 수 있는 문제입니다. 두 개 이상의 작업이 서로 상대방의 작업이 끝나기만을 기다리고 있기 때문에 결과적으로는 아무것도 완료되지 못하는 상태가 되게 됩니다.

### 요약

- 임계영역(Critical Section) 보호 미흡
- 동기화(뮤텍스, 세마포어, 모니터 등) 부재 또는 잘못된 사용
- 비원자적 연산(Atomic Operation이 아닌 연산)에서 발생
- 하드웨어/OS의 캐시 일관성 문제

## 3. 경쟁상태의 영향
- 데이터 불일치, 예측 불가한 결과
- 프로그램의 안정성, 신뢰성 저하
- 시스템 장애, 크래시, 무한 루프 등

## 4. 경쟁상태 해결 방법
- 임계영역을 명확히 정의하고, 동기화 기법(뮤텍스, 세마포어, 모니터 등) 적용
- 원자적 연산(Atomic Operation) 사용: CAS, Test-and-Set 등
- 하드웨어/OS 수준의 락, 캐시 일관성 프로토콜 활용
- 동기화 오버헤드 최소화: 임계영역 최소화, 락 분할, 락 프리(lock-free) 알고리즘

## Reference
https://hackmd.io/@KangMoo/Bk5Z1c_en
https://iredays.tistory.com/125
