# 교착상태(Deadlock)

## 1. 교착상태란?
교착상태(Deadlock)는 둘 이상의 프로세스(또는 스레드)가 서로 상대방이 점유한 자원을 기다리며 무한 대기하는 상태를 의미합니다. 즉, 각 프로세스가 필요한 자원을 점유하지 못하고 영원히 대기하게 되어 시스템 전체가 멈추는 심각한 동기화 문제입니다.

- 예시: 두 개의 프로세스가 각각 프린터와 파일을 점유한 뒤, 상대방의 자원을 요청하며 대기 → 서로 영원히 대기

## 2. 교착상태 발생 조건 (Coffman 조건)
교착상태가 발생하려면 다음 네 가지 조건이 모두 만족되어야 합니다. (필요충분)

1. **상호 배제(Mutual Exclusion)**: 자원은 한 번에 하나의 프로세스만 점유 가능 (세마포어, 뮤텍스, 모니터로 문제해소)
2. **점유와 대기(Hold and Wait)**: 자원을 점유한 상태에서 추가 자원을 요청하며 대기
3. **비선점(No Preemption)**: 점유한 자원을 강제로 빼앗을 수 없음
4. **환형 대기(Circular Wait)**: 프로세스들이 원형으로 자원을 기다림

![데드락](https://t1.daumcdn.net/cfile/tistory/243E89355714C26E28)

### 주로 발생하는 경우

- 멀티 프로그래밍 환경에서 한정된 자원을 얻기 위해 서로 경쟁하는 상황 발생
- 한 프로세스가 자원을 요청했을 때, 동시에 그 자원을 사용할 수 없는 상황이 발생할 수 있음. 이때 프로세스는 대기 상태로 들어감
- 대기 상태로 들어간 프로세스들이 실행 상태로 변경될 수 없을 때 '교착 상태' 발생

## 4. 교착상태 해결 방법

### 4.1 예방(Prevention)
- Coffman 조건 중 하나 이상을 제거
  - 자원 선점 허용, 점유와 대기 금지, 환형 대기 방지 등

### 4.2 회피(Avoidance)
- 자원 할당 시 교착상태가 발생하지 않도록 안전 상태(Safe State)만 허용
- 대표적 알고리즘: **은행원 알고리즘(Banker's Algorithm)**
  - 프로세스가 자원을 요구할 때, 시스템은 자원을 할당한 후에도 안정 상태로 남아있게 되는지 사전에 검사하여 교착 상태 회피
  - 안정상태면 자원 할당, 아니면 다른 프로세스들이 자원 해지까지 대기

### 4.3 탐지(Detection) 및 회복(Recovery)
- 교착상태 발생 여부를 주기적으로 검사
- 교착상태 발견 시 프로세스 강제 종료, 자원 회수 등
- 프로세스 종료 방법
  - 교착 상태의 프로세스를 모두 중지
  - 교착 상태가 제거될 때까지 하나씩 프로세스 중지

## 5. 교착상태와 운영체제
- 대부분의 OS는 교착상태 예방/회피/탐지 중 하나 이상을 적용
- 실시간 시스템, 데이터베이스, 네트워크 등에서 매우 중요한 문제


## Reference
https://gmlwjd9405.github.io/2018/10/27/deadlock.html
https://inpa.tistory.com/entry/OS-%F0%9F%92%BB-%EA%B5%90%EC%B0%A9%EC%83%81%ED%83%9C-%EA%B0%9C%EB%85%90-%EC%98%88%EB%B0%A9-%ED%9A%8C%ED%94%BC-%ED%83%90%EC%A7%80-%EB%B3%B5%EA%B5%AC
https://hackmd.io/@KangMoo/Bk5Z1c_en

